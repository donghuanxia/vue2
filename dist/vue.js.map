{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{   xxx  }}  \r\n\r\nfunction genProps(attrs) {\r\n    // {key:value,key:value,}\r\n    let str = '';\r\n    for (let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i];\r\n        if (attr.name === 'style') { // {name:id,value:'app'}\r\n            let styles = {}\r\n            attr.value.replace(/([^;:]+):([^;:]+)/g, function() {\r\n                styles[arguments[1]] = arguments[2];\r\n            })\r\n            attr.value = styles\r\n        }\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n    }\r\n    return `{${str.slice(0,-1)}}`\r\n}\r\n\r\nfunction gen(el) {\r\n    if (el.type == 1) {\r\n        return generate(el); // 如果是元素就递归的生成\r\n    } else {\r\n        let text = el.text; // {{}}\r\n        if (!defaultTagRE.test(text)) return `_v('${text}')`; // 说明就是普通文本\r\n\r\n        // 说明有表达式 我需要 做一个表达式和普通值的拼接 ['aaaa',_s(name),'bbb'].join('+)\r\n        // _v('aaaa'+_s(name) + 'bbb')\r\n        let lastIndex = defaultTagRE.lastIndex = 0;\r\n        let tokens = []; // <div> aaa{{bbb}} aaa </div>\r\n        let match;\r\n\r\n        // ，每次匹配的时候 lastIndex 会自动向后移动\r\n        while (match = defaultTagRE.exec(text)) { // 如果正则 + g 配合exec 就会有一个问题 lastIndex的问题\r\n            let index = match.index;\r\n            if(index > lastIndex){\r\n                tokens.push(JSON.stringify(text.slice(lastIndex,index)));\r\n            }\r\n            tokens.push(`_s(${match[1].trim()})`);\r\n            lastIndex = index + match[0].length;\r\n        }\r\n        if(lastIndex < text.length){\r\n            tokens.push(JSON.stringify(text.slice(lastIndex)));\r\n        }\r\n        return `_v(${tokens.join('+')})`; // webpack 源码 css-loader  图片处理\r\n    }\r\n}\r\n\r\nfunction genChildren(el) {\r\n    let children = el.children;\r\n    if (children) {\r\n        return children.map(item => gen(item)).join(',')\r\n    }\r\n    return false;\r\n}\r\n\r\n// _c(div,{},c1,c2,c3,c4)\r\nexport function generate(ast) {\r\n    let children = genChildren(ast)\r\n    let code = `_c('${ast.tag}',${\r\n        ast.attrs.length?genProps(ast.attrs) :'undefined'\r\n    }${\r\n        children? `,${children}` :''\r\n    })`\r\n    return code;\r\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`//匹配标签名 aa-xxx\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`//aa:aa-xxx\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`)//标签开头正则表达式 捕获的内容是标签名,匹配到结果的第一个（索引第一个）[1]\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`)//匹配标签结尾的</div> [1] \r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;//属性的匹配\r\nconst startTagClose = /^\\s*(\\/?)>/;//匹配标签结束符 >\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g ;//{{xxxx}}\r\nlet htm1 = 'id=app'\r\n//console.log('id=app'.match(attribute))// [1]属性的key, [3] || [4] || [5]属性的值\r\n\r\nfunction parserHTML(html){\r\n    //console.log(html)\r\n    let stack = []\r\n    let root  = null\r\n    //我要构建父子关系\r\n    function createASTElement(tag,attrs,parent = null){\r\n        return {\r\n            tag,\r\n            type:1,//元素\r\n            children:[],\r\n            parent,\r\n            attrs\r\n        }\r\n    }\r\n    function start(tagName,attrs){\r\n        //遇到开始标签 就取栈中的最后一个作为父节点\r\n        let parent = stack[stack.length-1]\r\n        let element = createASTElement(tagName,attrs,parent)\r\n        if(root == null){//说明当前节点就是根节点\r\n            root = element\r\n        }\r\n        if(parent){\r\n            element.parent = parent//更新p的parent属性 指向parent\r\n            parent.children.push(element)\r\n        }\r\n        stack.push(element)\r\n        //console.log('start',tagName,attrs)\r\n    }\r\n    function end(tagName){\r\n        let endTag = stack.pop(tagName)\r\n        if(endTag.tag != tagName){\r\n            console.log('标签出错')\r\n        }\r\n    }\r\n    function text(chars){\r\n        let parent = stack[stack.length-1]\r\n        chars = chars.replace(/\\s/g,\"\")//空格\r\n        if(chars){\r\n            parent.children.push({\r\n                type:2,\r\n                text:chars\r\n            })\r\n        }\r\n        console.log('chars',chars)\r\n    }\r\n    function advance(len){//将解析完的删除\r\n        html = html.substring(len)\r\n    }\r\n    function parseStargTag(){\r\n        const start = html.match(startTagOpen)\r\n        if(start){\r\n            const match = {\r\n                tagName:start[1],\r\n                attrs:[]\r\n            }\r\n            advance(start[0].length)\r\n            console.log(match,html)\r\n    \r\n            let end;\r\n            let attr;\r\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                match.attrs.push({\r\n                    name:attr[1],\r\n                    value:attr[3] || attr[4] || attr[5]\r\n                })// <div id=\"app\"\r\n                advance(attr[0].length)\r\n            }\r\n            if(end){\r\n                advance(end[0].length)\r\n            }\r\n            return match\r\n        }\r\n        return false\r\n        \r\n    }\r\n    while(html){\r\n        //解析标签和文本,看内容的第一个字符是不是<,如果第一个是<就是标签，如果第一个不是<,那就是文本\r\n        let index = html.indexOf('<')\r\n        //console.log('index-----',index)\r\n        if(index == 0){\r\n            //解析开始标签，并且把属性也解析出来\r\n            const startTagMatch = parseStargTag()\r\n            //console.log(startTagMatch)\r\n            if(startTagMatch){//开始标签\r\n                start(startTagMatch.tagName,startTagMatch.attrs)\r\n                continue;\r\n            }\r\n            let endTagMatch;\r\n            if(endTagMatch = html.match(endTag)){//结束标签\r\n                end(endTagMatch[1])\r\n                advance(endTagMatch[0].length)\r\n                continue;\r\n            }\r\n            break;\r\n        }\r\n        //文本\r\n        if(index > 0 ){\r\n            let chars = html.substring(0,index)\r\n            text(chars)\r\n            advance(chars.length)\r\n        }\r\n\r\n        \r\n    }\r\n    return root\r\n}\r\n\r\nexport default parserHTML","import { generate } from \"./generate\";\r\nimport parserHTML from \"./parser\";\r\n\r\nexport function compileToFunction(template){\r\n    //1.将模板生成ast语法树\r\n    let ast = parserHTML(template)\r\n    //代码优化，标记静态节点\r\n    //2.代码生成\r\n    let code = generate(ast)\r\n    let render = new Function(`with(this){return ${code}}`)\r\n    console.log(render.toString())\r\n    //1.编译原理\r\n    //2.响应式原理 依赖收集\r\n    //3.组件化开发（贯穿了vue的流程）\r\n    //4.diff算法\r\n}","export function isFunction(val){//判断是否为方法\r\n    return typeof val == 'function'\r\n}\r\n\r\nexport function isObject(val){//判断是否为对象\r\n    return typeof val == 'object'&& val!==null\r\n}\r\n\r\nexport let isArray = Array.isArray//判断是否为数组","let oldArrayPortotype = Array.prototype//获取数组老的原型方法\r\n\r\nexport let arrayMethods = Object.create(oldArrayPortotype)//让arrayMethods 通过__proto__能获取到数组的方法\r\n// arrayMethods.__proto__ == oldArrayPortotype\r\n// arrayMethods.push = function\r\nlet methods = [//只有这七个方法可以导致数组发生变化\r\n    'push',\r\n    'shift',\r\n    'pop',\r\n    'unshift',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method=>{\r\n    arrayMethods[method] = function(...args){\r\n        //数组新增的属性是不是对象，是对象，继续劫持\r\n        //调用数组的原生逻辑\r\n        oldArrayPortotype[method].call(this,...args)//又有自己的逻辑，又有原来的逻辑，函数切片\r\n        console.log(method,'数组的方法进行重新操作')\r\n        let inserted = null\r\n        let ob = this.__ob__\r\n        switch(method){\r\n            case 'splice'://删除，修改，添加，arr.splice(),第三个参数起为新添加的\r\n                inserted = args.splice(2);//splice方法从第三个参数开始都是新添加的\r\n                break;\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;//调用push 和unshift 传递的参数就是新增的逻辑\r\n                break;\r\n        }\r\n        if(inserted) ob.observeArray(inserted)\r\n    }\r\n})","import { isArray, isObject } from \"../utils\";\r\nimport { arrayMethods } from \"./array\";\r\n\r\n//原型链指向问题\r\n//1.每个对象都有一个__proto__属性， 它指向所属类的原型  fn.__proto__ = Function.prototype\r\n//2.每个原型上都有一个constructor属性，指向函数本身， Function.prototype.constructor = Function\r\n\r\nclass Observer{\r\n    constructor(value){\r\n        //不让__ob__被遍历\r\n        value.__ob__ = this\r\n        Object.defineProperty(value,'__ob__',{\r\n            value:this,\r\n            enumerable:false//表示这个属性不能被列举出来，也就是不能被枚举\r\n        })\r\n        if(isArray(value)){\r\n            //更改数组原型方法\r\n           value.__proto__ = arrayMethods//只重写vue里的七个方法\r\n           this.observeArray(value)\r\n        }else{\r\n            this.walk(value)//核心就是循环对象\r\n        }\r\n        \r\n    }\r\n    observeArray(data){//递归遍历数组，对数组内部的额对象再次重写[[]]\r\n        data.forEach(item=>observe(item))//数组里面如果是引用类型的那么是响应式的\r\n        //vm.arr[0].a = 100//会触发\r\n        //vm.arr[0]=100 不会触发，更改索引不会触发\r\n    }\r\n    walk(data){\r\n        Object.keys(data).forEach(key=>{//要使用defineProperty重新定义\r\n            defineReactive(data,key,data[key])\r\n        })\r\n    }\r\n}\r\n//vue2 应用了defineProperty需要一加载的时候，就进行递归操作， 所以耗性能，如果层次过深也会浪费性能\r\n//1.性能优化的原则\r\n//1)不要把所有的数据都放到data中，因为所有的数据都会增加get和set\r\n//2)不要写数据的时候 层次过深，尽量扁平化数据\r\n//3)不要频繁获取数据\r\n//4)如果数据不需要响应式，可以使用Object.freeze冻结属性\r\nfunction defineReactive(obj,key,value){//vue2慢的原因 主要在这个方法中\r\n    observe(value)\r\n    Object.defineProperty(obj,key,{\r\n        get(){\r\n            return value//闭包，此value 会向上层的value查找\r\n        },\r\n        set(newValue){\r\n            if(value === newValue) return \r\n            value = newValue\r\n            console.log('秀嘎')\r\n            observe(newValue)\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(value){\r\n    //1、如果value不是对象，就不需要观测了，说明写的有问题\r\n    if(!isObject(value)){\r\n        return\r\n    }\r\n    if(value.__ob__){\r\n        return//一个对象不需要被重新观测\r\n    }\r\n    //需要对对象进行观测，最外层必须是一个{}，不能是数组\r\n    //如果一个数据已经被观测过了，就不要在观测了，用类来实现，我观测过就增加一个标识，说明观测过了，在观测时候可以先检测是否观测过\r\n    //如果观测过了就跳过\r\n\r\n    return new Observer(value)\r\n    console.log(value)\r\n}\r\n","import { observe } from \"./observe\"//rollup-plugin-node-resolve 安装这个插件可以自动解析文件夹里的index.js文件\r\nimport { isFunction } from \"./utils\"\r\n\r\nexport function initState(vm){\r\n     const options = vm.$options\r\n     if(options.data){\r\n         //做数据的初始化\r\n         initData(vm)\r\n     }\r\n}\r\n\r\nfunction proxy(vm,key,source){//取值的时候做代理，不是暴力的把_data属性赋予给vm,而且直接赋值会有命名冲突的问题\r\n    \r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key];\r\n        },\r\n        set(newValue){\r\n            vm[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm){\r\n    let data = vm.$options.data//用户传入的数据\r\n\r\n    //如果用户传递的是一个函数，则取函数的返回值作为对象，如果就是对象那就直接使用这个对象\r\n    //只有根实例可以data一个对象\r\n    data = vm._data = isFunction(data) ? data.call(vm) : data//判断data 是函数还是对象,_data已经是响应式的了\r\n    //需要将data变成响应式的， Object.defineProperty,重写data的所有属性\r\n    observe(data)//取观测数据，重要，核心模块\r\n    //console.log('222',data)\r\n    //data.arr.push(100)\r\n    //data.arr.pop(100)\r\n    for(let key in data){//vm.message=>vm._data.message\r\n        proxy(vm,key,'_data')\r\n    }\r\n    //vm.message = vm._data.message\r\n}","import { compileToFunction } from \"./compiler\"\r\nimport { initState } from \"./state\"\r\n\r\nexport function initMixin(Vue){\r\n    //后续组件话开发的时候，Vue.extend可以创造一个子组件，子组件可以继承Vue，子组件也可以调用_init方法\r\n    Vue.prototype._init = function(options){\r\n        const vm = this\r\n        //把用户的选项都放到vm上，这样在其他方法中可以获取到options\r\n        vm.$options = options//为了后续扩展的方法，都可以获取$options选项\r\n        console.log(vm)\r\n        initState(vm)\r\n        if(vm.$options.el){\r\n            //要将数据挂载到页面上\r\n            //现在数据已经被劫持了，数据变换需更新视图 diff 算法更新需要更新的部分\r\n            //vue -> template（写起来更符合直觉） -> jsx（灵活）\r\n            //vue3-> template写起来性能会更高一些，内部做了很多优化\r\n            //template -> ast语法树（用来描述语法的，描述语法本身的）->描述成一个树结构 -> 将代码重组成js语法\r\n            // 模板编译原理（把template模板编译成render函数->虚拟DOM ->diff算法比对虚拟DOM)\r\n            //ast ->render返回->vnode —》 生成真实DOM\r\n            // 更新的时候再次调用render-》新的vnode ->新旧比对，--》更新真是的dom\r\n            vm.$mount(vm.$options.el)\r\n            console.log('页面进行挂载了')\r\n        }\r\n    },\r\n    Vue.prototype.$mount = function(el){\r\n        const vm = this\r\n        const opts = vm.$options\r\n        el = document.querySelector(el)\r\n        vm.$el = el//页面真实的数据\r\n        if(!opts.render){\r\n            //模板编译\r\n            let template = opts.template\r\n            if(!template){\r\n                template = el.outerHTML\r\n            }\r\n            let render = compileToFunction(template)\r\n            opts.render = render\r\n        }\r\n    }   \r\n}","import { initMixin } from \"./init\";\r\n\r\n//vue 要如何实现， 原型模式， 所有的功能都通过原型扩展的方式添加\r\nfunction Vue(options){\r\n    //实现vue的初始化功能\r\n    this._init(options)\r\n}\r\ninitMixin(Vue)\r\n\r\n//导出Vue给别人使用\r\nexport default Vue;\r\n\r\n//1.new Vue 会调用_init方法进行初始化操作\r\n//2.会将用户的选项放到vm.$options上\r\n//3.会对当前属性上搜索有没有data数据 initState\r\n//4.有data 判断data是不是一个函数，如果是函数，取值返回initData\r\n//5.observe 去观测data中的数据 和vm没有关系，说明datayijign 变成了响应式的\r\n//6.vm上像取值也能取到data中的数据vm._data = data 这样用户能取到data 了 vm._data\r\n//7.用户觉得有点麻烦 vm.xx => vm._data.xx\r\n//8.如果更新对象不存在的属性，会导致视图不更新，如果是数组更新索引和长度不会触发更新\r\n//9.如果替换成一个新对象，新对象会被进行劫持，如果是数组存新内容 push unshift() 新增的内容也会被劫持\r\n//通过__ob__进行标识这个对象被监控过， 在(vue 中被监控的对象身上都有一个__ob__这个属性)\r\n//10.如果你就想改变索引 可以使用$set方法， 内部就是splice()\r\n"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","styles","value","replace","arguments","JSON","stringify","slice","gen","el","type","generate","text","test","lastIndex","tokens","match","exec","index","push","trim","join","genChildren","children","map","item","ast","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","stack","root","createASTElement","parent","start","tagName","element","end","pop","console","log","chars","advance","len","substring","parseStargTag","indexOf","startTagMatch","endTagMatch","compileToFunction","template","render","Function","toString","isFunction","val","isObject","isArray","Array","oldArrayPortotype","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","splice","observeArray","Observer","constructor","defineProperty","enumerable","__proto__","walk","data","observe","keys","key","defineReactive","obj","get","set","newValue","initState","vm","options","$options","initData","proxy","source","_data","initMixin","Vue","_init","$mount","opts","document","querySelector","$el","outerHTML"],"mappings":"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"}